# Session Summary 2026-02-16

## Lynis Audit Runner Design

**Unresolved:**
- salt-ssh infrastructure (roster file, master config) not yet created — prerequisite for the runner
- Multi-target parallel execution deferred
- Custom Lynis profiles deferred
- Whether `salt/runners/` will be used later when a master daemon is introduced

Explored how to implement on-demand Lynis security audits across nodes. Discussed the purpose of the `salt/runners/` directory (master-side execution modules) and where an SSH-based audit tool fits in the project's evolution toward salt-ssh central management.

Researched Lynis capabilities: audit modes (`--cronjob`, `--quiet`, `--pentest`), targeted scanning (`--tests-from-category`), output files (`lynis-report.dat` key=value format, `lynis.log`), custom profiles, and exit codes.

Designed a 6-step audit workflow: connect via salt-ssh, install Lynis, run audit, fetch results, remove Lynis and artifacts, then analyze locally. Key architectural decision: **standalone Python script in `scripts/`** rather than a Salt runner module, because there is no master daemon and the workflow is imperative, not declarative. This matches the existing `scripts/test.sh` pattern.

Report storage design: `reports/lynis/<hostname>/<timestamp>/` with raw report, log, and parsed `summary.json` — gitignored like `secrets/`. Differential analysis uses set-based comparison on Lynis test IDs between runs, producing new/resolved warnings and suggestions plus hardening index delta. Plan written but not yet approved for implementation.

## Exim4 SMTP Credentials Management

**Unresolved:**
- No encryption of secrets at rest (SOPS/GPG deferred)
- Production credentials not yet populated in `secrets/passwd.client`

Moved SMTP credentials out of pillar into a static file (`secrets/passwd.client`) deployed via `file://` source. Previously `passwd.client` was a Jinja template rendered from `mail.smarthost_user` and `mail.smarthost_password` pillar values — now it's a plain file in the gitignored `secrets/` directory, mounted read-only into the Docker container at `/srv/secrets`.

Discussed encryption options: Salt's built-in GPG renderer (works with both masterless and salt-ssh, decrypts on the control side), and SOPS with age/PGP backends. Both decrypt on the master/control machine. Decided against implementing encryption for now — the simple secrets file approach is sufficient for the current stage.

Added a roadmap note in README about planned migration from masterless `salt-call --local` to `salt-ssh`. Committed as `8c0326b`.
