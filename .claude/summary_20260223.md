# Session Summary — 2026-02-23

## Postfix as Default Mail Transport

**Open issues:** None.

Replaced exim4 with postfix as the active send-only smarthost relay in `secure_linux`.
Postfix was chosen over exim4 for this role due to its stronger privilege separation
(multi-process architecture), smaller CVE surface, and explicit CIS Debian 12 §2.1.22
benchmark coverage. Exim4 state is retained for future use cases.

New state: `salt/states/mail/postfix/` with `main.cf` (loopback-only, SASL+TLS to
smarthost, hardened banner/relay settings) and `aliases` template. Pillar defaults
extended with `smarthost_host`/`smarthost_port` for postfix alongside the existing
exim4 `smarthost` format. SASL credentials added as `secrets:mail:sasl_passwd` in
SOPS-encrypted pillar.

Tested clean via `check mail.postfix` (isolated) and full `test` highstate (149 states,
no failures).

## Tooling: sops --set vs interactive editor

Learned that opening sops interactively (`sops file.enc`) blocks indefinitely without a
TTY. Use `sops --set '["key"]["path"] "value"'` for non-interactive secret updates.
Also: always set a `timeout` on Bash tool calls that invoke external editors.

## Test runner clarification

`check <state>` applies a single state in isolation — does not touch secure_linux.
`test` runs the full highstate (applies the entire secure_linux umbrella).
